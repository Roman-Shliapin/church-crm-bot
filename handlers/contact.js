// –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ —Å–ª—É–∂–∏—Ç–µ–ª—ñ–≤
import { Markup } from "telegraf";
import { createMainMenu, createContactMenu } from "./commands.js";

/**
 * –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /contact –∞–±–æ –∫–Ω–æ–ø–∫–∏ "–ó–≤'—è–∑–∞—Ç–∏—Å—è –∑ –Ω–∞–º–∏" - –ø–æ–∫–∞–∑—É—î –∫–æ–Ω—Ç–∞–∫—Ç–∏ —Å–ª—É–∂–∏—Ç–µ–ª—ñ–≤
 */
export async function handleContact(ctx) {
  const message =
    "üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ —Å–ª—É–∂–∏—Ç–µ–ª—ñ–≤ –¶–µ—Ä–∫–≤–∏ –•—Ä–∏—Å—Ç–æ–≤–æ—ó —É –í—ñ–Ω–Ω–∏—Ü—ñ:\n\n" +
    "üìç –ê–¥—Ä–µ—Å–∞:\n" +
    "–í—ñ–Ω–Ω–∏—Ü—è, –≤—É–ª. –ú–∞–≥—ñ—Å—Ç—Ä–∞—Ç—Å—å–∫–∞ 11, –æ—Ñ—ñ—Å 10\n\n" +
    "üìû –¢–µ–ª–µ—Ñ–æ–Ω:\n" +
    "+380 (93) 223 25 26 –û–ª–µ–∫—Å—ñ–π\n\n" +
    "üïäÔ∏è –Ø–∫—â–æ —É –≤–∞—Å —î –ø–∏—Ç–∞–Ω–Ω—è, –ø–æ—Ç—Ä–µ–±–∏ –∞–±–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥—É—Ö–æ–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞, " +
    "–∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞—à–∏–º–∏ —Å–ª—É–∂–∏—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ —Ü—å–æ–≥–æ –±–æ—Ç–∞ –∞–±–æ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ.\n\n" +
    "üîí –í–∞—à—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –±–µ–∑–ø–µ—Ü—ñ —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Å–ª—É–∂—ñ–Ω–Ω—è.\n\n" +
    "üôè –ú–∏ –∑–∞–≤–∂–¥–∏ –≥–æ—Ç–æ–≤—ñ –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º!";

  return ctx.reply(message, createContactMenu());
}

/**
 * –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç —Ü–µ—Ä–∫–≤–∏"
 */
export async function handleChurchChat(ctx) {
  const chatLink = process.env.CHURCH_CHAT_LINK;
  const chatUsername = process.env.CHURCH_CHAT_USERNAME;
  
  if (!chatLink && !chatUsername) {
    await ctx.reply(
      "‚ö†Ô∏è –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —á–∞—Ç —Ü–µ—Ä–∫–≤–∏ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ.\n\n" +
      "–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.",
      createContactMenu()
    );
    return;
  }
  
  // –Ø–∫—â–æ —î –ø–æ—Å–∏–ª–∞–Ω–Ω—è - –ø–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
  if (chatLink) {
    // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤–∞–ª—ñ–¥–Ω–µ
    const validLink = chatLink.trim();
    
    await ctx.reply(
      "üí¨ –ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—à–æ–≥–æ —á–∞—Ç—É –¥–ª—è —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏:",
      Markup.inlineKeyboard([
        [Markup.button.url("üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç —Ü–µ—Ä–∫–≤–∏", validLink)]
      ])
    );
    await ctx.reply("–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂—á–µ:", createContactMenu());
  } else if (chatUsername) {
    // –Ø–∫—â–æ —î —Ç—ñ–ª—å–∫–∏ username - –ø–æ–∫–∞–∑—É—î–º–æ –π–æ–≥–æ
    const link = chatUsername.startsWith("@") 
      ? `https://t.me/${chatUsername.slice(1)}`
      : `https://t.me/${chatUsername}`;
    
    await ctx.reply(
      "üí¨ –ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—à–æ–≥–æ —á–∞—Ç—É –¥–ª—è —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏:",
      Markup.inlineKeyboard([
        [Markup.button.url("üí¨ –ü–µ—Ä–µ–π—Ç–∏ –≤ —á–∞—Ç —Ü–µ—Ä–∫–≤–∏", link)]
      ])
    );
    await ctx.reply("–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂—á–µ:", createContactMenu());
  }
}

/**
 * –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ "–í–∏–π—Ç–∏ –Ω–∞ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é"
 */
export async function handleBackToMainMenu(ctx) {
  const menu = await createMainMenu(ctx);
  await ctx.reply("üè† –ü–æ–≤–µ—Ä–Ω—É–ª–∏—Å—è –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é", menu);
}
